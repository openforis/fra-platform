import { Assessment, AssessmentNames, Cycle } from 'meta/assessment'

import { AssessmentController } from 'server/controller/assessment'
import { BaseProtocol, DB, Schemas } from 'server/db'

const client: BaseProtocol = DB

/**
 * 1a. Insert value_aggregate into node_ext for fra 2020
 * 1b. Insert value_aggregate.totalLandArea into node_ext for fra 2025 and 2020
 * 2. Drop value_aggregate
 * Note: We don't migrate values that are not associated with a table,
 *       eg. precalculated ratios or sums or totals
 * Note: We don't migrate values that are already in node_ext
 * Note: We don't migrate forestArea, even when not found in node as we have 100% data for countries for forestArea in either node or ODP tables
 */

// {"fra":{"2020":{"FIN":{"extentOfForest":{"1990":{"total":{"odp":true,"raw":"21875.33","odpId":231},"otherLand":{"odp":true,"raw":"7589.769999999999","odpId":231},"forestArea":{"odp":true,"raw":"21875.33","odpId":231},"plantedForest":{"odp":true,"raw":"4390.378731","odpId":231},"primaryForest":{"odp":true,"raw":null,"odpId":231},"totalLandArea":{"odp":true,"raw":"30391","odpId":231},"otherWoodedLand":{"odp":true,"raw":"925.9","odpId":231},"totalForestArea":{"odp":true,"raw":"21875.33","odpId":231},"naturalForestArea":{"odp":true,"raw":"17484.951269","odpId":231},"plantationForestArea":{"odp":true,"raw":"21.87533","odpId":231},"otherPlantedForestArea":{"odp":true,"raw":"4368.503401","odpId":231},"plantationForestIntroducedArea":{"odp":true,"raw":"21.87533","odpId":231}},"2000":{"total":{"odp":true,"raw":"22445.64","odpId":232},"otherLand":{"odp":true,"raw":"7121.880000000001","odpId":232},"forestArea":{"odp":true,"raw":"22445.64","odpId":232},"plantedForest":{"odp":true,"raw":"5144.540688","odpId":232},"primaryForest":{"odp":true,"raw":null,"odpId":232},"totalLandArea":{"odp":true,"raw":"30391","odpId":232},"otherWoodedLand":{"odp":true,"raw":"823.48","odpId":232},"totalForestArea":{"odp":true,"raw":"22445.64","odpId":232},"naturalForestArea":{"odp":true,"raw":"17301.099312","odpId":232},"plantationForestArea":{"odp":true,"raw":"24.690204","odpId":232},"otherPlantedForestArea":{"odp":true,"raw":"5119.850484","odpId":232},"plantationForestIntroducedArea":{"odp":true,"raw":"24.690204","odpId":232}},"2010":{"total":{"odp":true,"raw":"22242","odpId":233},"otherLand":{"odp":true,"raw":"7360","odpId":233},"forestArea":{"odp":true,"raw":"22242","odpId":233},"plantedForest":{"odp":true,"raw":"6908.3652","odpId":233},"primaryForest":{"odp":true,"raw":null,"odpId":233},"totalLandArea":{"odp":true,"raw":"30391","odpId":233},"otherWoodedLand":{"odp":true,"raw":"789","odpId":233},"totalForestArea":{"odp":true,"raw":"22242","odpId":233},"naturalForestArea":{"odp":true,"raw":"15333.6348","odpId":233},"plantationForestArea":{"odp":true,"raw":"33.363","odpId":233},"otherPlantedForestArea":{"odp":true,"raw":"6875.0022","odpId":233},"plantationForestIntroducedArea":{"odp":true,"raw":"33.363","odpId":233}},"2015":{"total":{"odp":true,"raw":"22409","odpId":234},"otherLand":{"odp":true,"raw":"7236","odpId":234},"forestArea":{"odp":true,"raw":"22409","odpId":234},"plantedForest":{"odp":true,"raw":"7368.0792","odpId":234},"primaryForest":{"odp":true,"raw":null,"odpId":234},"totalLandArea":{"odp":true,"raw":"30391","odpId":234},"otherWoodedLand":{"odp":true,"raw":"746","odpId":234},"totalForestArea":{"odp":true,"raw":"22409","odpId":234},"naturalForestArea":{"odp":true,"raw":"15040.9208","odpId":234},"plantationForestArea":{"odp":true,"raw":"33.6135","odpId":234},"otherPlantedForestArea":{"odp":true,"raw":"7334.4657","odpId":234},"plantationForestIntroducedArea":{"odp":true,"raw":"33.6135","odpId":234}},"2016":{"otherLand":{"raw":"7236","calculated":true},"forestArea":{"raw":"22409.00","estimated":true},"totalLandArea":{"raw":"30391"},"otherWoodedLand":{"raw":"746.00","estimated":true}},"2017":{"otherLand":{"raw":"7236","calculated":true},"forestArea":{"raw":"22409.00","estimated":true},"totalLandArea":{"raw":"30391"},"otherWoodedLand":{"raw":"746.00","estimated":true}},"2018":{"otherLand":{"raw":"7236","calculated":true},"forestArea":{"raw":"22409.00","estimated":true},"totalLandArea":{"raw":"30391"},"otherWoodedLand":{"raw":"746.00","estimated":true}},"2019":{"otherLand":{"raw":"7236","calculated":true},"forestArea":{"raw":"22409.00","estimated":true},"totalLandArea":{"raw":"30391"},"otherWoodedLand":{"raw":"746.00","estimated":true}},"2020":{"otherLand":{"raw":"7236","calculated":true},"forestArea":{"raw":"22409.00","estimated":true},"totalLandArea":{"raw":"30391"},"otherWoodedLand":{"raw":"746.00","estimated":true}}},"growingStockTotal":{"1990":{"forest":{"raw":"1878.00"},"plantedForest":{"raw":null,"calculated":true},"otherWoodedLand":{"raw":"7.00"},"plantationForest":{"raw":null,"calculated":true},"otherPlantedForest":{"raw":null,"calculated":true},"naturallyRegeneratingForest":{"raw":null,"calculated":true}},"2000":{"forest":{"raw":"2078.00"},"plantedForest":{"raw":"270.00"},"otherWoodedLand":{"raw":"5.24"},"plantationForest":{"raw":"0.78"},"otherPlantedForest":{"raw":"270.00"},"naturallyRegeneratingForest":{"raw":"1808.00"}},"2010":{"forest":{"raw":"2343.07"},"plantedForest":{"raw":"558.64"},"otherWoodedLand":{"raw":"7.65"},"plantationForest":{"raw":"2.55"},"otherPlantedForest":{"raw":"556.10"},"naturallyRegeneratingForest":{"raw":"1784.43"}},"2015":{"forest":{"raw":"2448.85"},"plantedForest":{"raw":"659.08"},"otherWoodedLand":{"raw":"7.13"},"plantationForest":{"raw":"3.00"},"otherPlantedForest":{"raw":"656.08"},"naturallyRegeneratingForest":{"raw":"1789.77"}},"2016":{"forest":{"raw":"2448.85"},"plantedForest":{"raw":"659.08"},"otherWoodedLand":{"raw":"7.13"},"plantationForest":{"raw":"2.9996925"},"otherPlantedForest":{"raw":"656.0683415"},"naturallyRegeneratingForest":{"raw":"1789.77"}},"2017":{"forest":{"raw":"2448.85"},"plantedForest":{"raw":"659.074756"},"otherWoodedLand":{"raw":"7.13"},"plantationForest":{"raw":"2.9996925"},"otherPlantedForest":{"raw":"656.0683415"},"naturallyRegeneratingForest":{"raw":"1789.7190708"}},"2018":{"forest":{"raw":"2448.85"},"plantedForest":{"raw":"659.074756"},"otherWoodedLand":{"raw":"7.13"},"plantationForest":{"raw":"2.9996925"},"otherPlantedForest":{"raw":"656.0683415"},"naturallyRegeneratingForest":{"raw":"1789.7190708"}},"2019":{"forest":{"raw":"2448.85"},"plantedForest":{"raw":"659.074756"},"otherWoodedLand":{"raw":"7.13"},"plantationForest":{"raw":"2.9996925"},"otherPlantedForest":{"raw":"656.0683415"},"naturallyRegeneratingForest":{"raw":"1789.7190708"}},"2020":{"forest":{"raw":"2448.85"},"plantedForest":{"raw":"659.074756"},"otherWoodedLand":{"raw":"7.13"},"plantationForest":{"raw":"2.9996925"},"otherPlantedForest":{"raw":"656.0683415"},"naturallyRegeneratingForest":{"raw":"1789.7190708"}}},"carbonStock":{"1990":{"carbon_forest_soil":{"raw":"165.15"},"carbon_forest_litter":{"raw":"10.03"},"carbon_forest_deadwood":{"raw":"0.68"},"carbon_forest_above_ground":{"raw":"21.93"},"carbon_forest_below_ground":{"raw":"6.52"},"carbon_stock_biomass_total":{"raw":"622353.1385","calculated":true},"carbon_stock_total":{"raw":"4469348.6723","calculated":true}},"2000":{"carbon_forest_soil":{"raw":"166.46"},"carbon_forest_litter":{"raw":"10.76"},"carbon_forest_deadwood":{"raw":"0.68"},"carbon_forest_above_ground":{"raw":"24.57"},"carbon_forest_below_ground":{"raw":"7.60"},"carbon_stock_biomass_total":{"raw":"722076.2388","calculated":true},"carbon_stock_total":{"raw":"4715155.5948","calculated":true}},"2010":{"carbon_forest_soil":{"raw":"168.65"},"carbon_forest_litter":{"raw":"11.26"},"carbon_forest_deadwood":{"raw":"0.74"},"carbon_forest_above_ground":{"raw":"26.82"},"carbon_forest_below_ground":{"raw":"8.25"},"carbon_stock_biomass_total":{"raw":"780026.94","calculated":true},"carbon_stock_total":{"raw":"4798044.24","calculated":true}},"2015":{"carbon_forest_soil":{"raw":"166.66"},"carbon_forest_litter":{"raw":"11.26"},"carbon_forest_deadwood":{"raw":"0.74"},"carbon_forest_above_ground":{"raw":"29.88"},"carbon_forest_below_ground":{"raw":"8.65"},"carbon_stock_biomass_total":{"raw":"863418.77","calculated":true},"carbon_stock_total":{"raw":"4867010.71","calculated":true}},"2016":{"carbon_forest_soil":{"raw":"166.66"},"carbon_forest_litter":{"raw":"11.26"},"carbon_forest_deadwood":{"raw":"0.74"},"carbon_forest_above_ground":{"raw":"29.88"},"carbon_forest_below_ground":{"raw":"8.65"},"carbon_stock_biomass_total":{"raw":"863418.77","calculated":true},"carbon_stock_total":{"raw":"4867010.71","calculated":true}},"2017":{"carbon_forest_soil":{"raw":"166.66"},"carbon_forest_litter":{"raw":"11.26"},"carbon_forest_deadwood":{"raw":"0.74"},"carbon_forest_above_ground":{"raw":"29.88"},"carbon_forest_below_ground":{"raw":"8.65"},"carbon_stock_biomass_total":{"raw":"863418.77","calculated":true},"carbon_stock_total":{"raw":"4867010.71","calculated":true}},"2018":{"carbon_forest_soil":{"raw":"166.66"},"carbon_forest_litter":{"raw":"11.26"},"carbon_forest_deadwood":{"raw":"0.74"},"carbon_forest_above_ground":{"raw":"29.88"},"carbon_forest_below_ground":{"raw":"8.65"},"carbon_stock_biomass_total":{"raw":"863418.77","calculated":true},"carbon_stock_total":{"raw":"4867010.71","calculated":true}},"2019":{"carbon_forest_soil":{"raw":"166.66"},"carbon_forest_litter":{"raw":"11.26"},"carbon_forest_deadwood":{"raw":"0.74"},"carbon_forest_above_ground":{"raw":"29.88"},"carbon_forest_below_ground":{"raw":"8.65"},"carbon_stock_biomass_total":{"raw":"863418.77","calculated":true},"carbon_stock_total":{"raw":"4867010.71","calculated":true}},"2020":{"carbon_forest_soil":{"raw":"166.66"},"carbon_forest_litter":{"raw":"11.26"},"carbon_forest_deadwood":{"raw":"0.74"},"carbon_forest_above_ground":{"raw":"29.88"},"carbon_forest_below_ground":{"raw":"8.65"},"carbon_stock_biomass_total":{"raw":"863418.77","calculated":true},"carbon_stock_total":{"raw":"4867010.71","calculated":true}}},"specificForestCategories":{"1990":{"bamboo":{"raw":"0.00"},"mangroves":{"raw":"0.00"},"rubber_wood":{"raw":"0.00"},"primary_forest":{"raw":null},"temporarily_unstocked":{"raw":"1607.00"}},"2000":{"bamboo":{"raw":"0.00"},"mangroves":{"raw":"0.00"},"rubber_wood":{"raw":"0.00"},"primary_forest":{"raw":null},"temporarily_unstocked":{"raw":"1542.14"}},"2010":{"bamboo":{"raw":"0.00"},"mangroves":{"raw":"0.00"},"rubber_wood":{"raw":"0.00"},"primary_forest":{"raw":"234.00"},"temporarily_unstocked":{"raw":"1595.00"}},"2015":{"bamboo":{"raw":"0.00"},"mangroves":{"raw":"0.00"},"rubber_wood":{"raw":"0.00"},"primary_forest":{"raw":"203.00"},"temporarily_unstocked":{"raw":"1418.00"}},"2020":{"bamboo":{"raw":"0.00"},"mangroves":{"raw":"0.00"},"rubber_wood":{"raw":"0.00"},"primary_forest":{"raw":"203.00"},"temporarily_unstocked":{"raw":"1418.00"}}},"forestAreaWithinProtectedAreas":{"1990":{"of_which_in_protected_areas":{"raw":"1235.20"},"forest_area_within_protected_areas":{"raw":"1235.20"},"forest_area_with_long_term_management_plan":{"raw":"21875.33"}},"2000":{"of_which_in_protected_areas":{"raw":"2223.11"},"forest_area_within_protected_areas":{"raw":"2223.11"},"forest_area_with_long_term_management_plan":{"raw":"22445.64"}},"2010":{"of_which_in_protected_areas":{"raw":"3001.51"},"forest_area_within_protected_areas":{"raw":"3001.51"},"forest_area_with_long_term_management_plan":{"raw":"22242.49"}},"2015":{"of_which_in_protected_areas":{"raw":"2830.66"},"forest_area_within_protected_areas":{"raw":"2830.66"},"forest_area_with_long_term_management_plan":{"raw":"22409.00"}},"2016":{"of_which_in_protected_areas":{"raw":"2830.66"},"forest_area_within_protected_areas":{"raw":"2830.66"},"forest_area_with_long_term_management_plan":{"raw":"22409.00"}},"2017":{"of_which_in_protected_areas":{"raw":"2830.66"},"forest_area_within_protected_areas":{"raw":"2830.66"},"forest_area_with_long_term_management_plan":{"raw":"22409.00"}},"2018":{"of_which_in_protected_areas":{"raw":"2830.66"},"forest_area_within_protected_areas":{"raw":"2830.66"},"forest_area_with_long_term_management_plan":{"raw":"22409.00"}},"2019":{"of_which_in_protected_areas":{"raw":"2830.66"},"forest_area_within_protected_areas":{"raw":"2830.66"},"forest_area_with_long_term_management_plan":{"raw":"22409.00"}},"2020":{"of_which_in_protected_areas":{"raw":"2830.66"},"forest_area_within_protected_areas":{"raw":"2830.66"},"forest_area_with_long_term_management_plan":{"raw":"22409.00"}}},"forestOwnership":{"1990":{"totalForestArea":{"raw":"21875.33000000000000000000","calculated":true},"other_or_unknown":{"raw":"0.33","calculated":true},"public_ownership":{"raw":"6722.00"},"private_ownership":{"raw":"15153.00"},"of_which_by_communities":{"raw":"0.00"},"of_which_by_individuals":{"raw":"12972.00"},"of_which_by_private_businesses":{"raw":"2181.00"}},"2000":{"totalForestArea":{"raw":"22445.64000000000000000000","calculated":true},"other_or_unknown":{"raw":"26.33","calculated":true},"public_ownership":{"raw":"7209.35"},"private_ownership":{"raw":"15209.96"},"of_which_by_communities":{"raw":"0.00"},"of_which_by_individuals":{"raw":"13296.33"},"of_which_by_private_businesses":{"raw":"1913.63"}},"2010":{"totalForestArea":{"raw":"22242.00000000000000000000","calculated":true},"other_or_unknown":{"raw":"71.05","calculated":true},"public_ownership":{"raw":"6682.70"},"private_ownership":{"raw":"15488.25"},"of_which_by_communities":{"raw":"0.00"},"of_which_by_individuals":{"raw":"13434.67"},"of_which_by_private_businesses":{"raw":"2053.58"}},"2015":{"totalForestArea":{"raw":"22409.00000000000000000000","calculated":true},"other_or_unknown":{"raw":"150.33","calculated":true},"public_ownership":{"raw":"6861.23"},"private_ownership":{"raw":"15397.44"},"of_which_by_communities":{"raw":"0.00"},"of_which_by_individuals":{"raw":"13325.39"},"of_which_by_private_businesses":{"raw":"2072.05"}},"2020":{"totalForestArea":{"raw":"22409.00","calculated":true},"other_or_unknown":{"raw":null,"calculated":true}}},"primaryDesignatedManagementObjective":{"1990":{"other":{"raw":null},"no_unknown":{"raw":"20240.04","calculated":true},"production":{"raw":null},"multiple_use":{"raw":null},"social_services":{"raw":"400.09"},"totalForestArea":{"raw":"21875.33000000000000000000","calculated":true},"conservation_of_biodiversity":{"raw":"1235.20"},"protection_of_soil_and_water":{"raw":null}},"2000":{"other":{"raw":"916.01"},"no_unknown":{"raw":"18700.53","calculated":true},"production":{"raw":null},"multiple_use":{"raw":null},"social_services":{"raw":"605.99"},"totalForestArea":{"raw":"22445.64000000000000000000","calculated":true},"conservation_of_biodiversity":{"raw":"2223.11"},"protection_of_soil_and_water":{"raw":null}},"2010":{"other":{"raw":"287.13"},"no_unknown":{"raw":"18353.85","calculated":true},"production":{"raw":null},"multiple_use":{"raw":null},"social_services":{"raw":"599.51"},"totalForestArea":{"raw":"22242.00000000000000000000","calculated":true},"conservation_of_biodiversity":{"raw":"3001.51"},"protection_of_soil_and_water":{"raw":null}},"2015":{"other":{"raw":"339.83"},"no_unknown":{"raw":"18708.75","calculated":true},"production":{"raw":null},"multiple_use":{"raw":null},"social_services":{"raw":"529.76"},"totalForestArea":{"raw":"22409.00000000000000000000","calculated":true},"conservation_of_biodiversity":{"raw":"2830.66"},"protection_of_soil_and_water":{"raw":null}},"2020":{"other":{"raw":"339.83"},"no_unknown":{"raw":"18708.75","calculated":true},"production":{"raw":null},"multiple_use":{"raw":null},"social_services":{"raw":"529.76"},"totalForestArea":{"raw":"22409.00","calculated":true},"conservation_of_biodiversity":{"raw":"2830.66"},"protection_of_soil_and_water":{"raw":null}}},"forestCharacteristics":{"1990":{"total":{"odp":true,"raw":"21875.33","odpId":231},"otherLand":{"odp":true,"raw":"7589.769999999999","odpId":231},"forestArea":{"odp":true,"raw":"21875.33","odpId":231},"plantedForest":{"odp":true,"raw":"4390.378731","odpId":231},"primaryForest":{"odp":true,"raw":null,"odpId":231},"totalLandArea":{"odp":true,"raw":"30391","odpId":231},"otherWoodedLand":{"odp":true,"raw":"925.9","odpId":231},"totalForestArea":{"odp":true,"raw":"21875.33","odpId":231},"naturalForestArea":{"odp":true,"raw":"17484.951269","odpId":231},"plantationForestArea":{"odp":true,"raw":"21.87533","odpId":231},"otherPlantedForestArea":{"odp":true,"raw":"4368.503401","odpId":231},"plantationForestIntroducedArea":{"odp":true,"raw":"21.87533","odpId":231}},"2000":{"total":{"odp":true,"raw":"22445.64","odpId":232},"otherLand":{"odp":true,"raw":"7121.880000000001","odpId":232},"forestArea":{"odp":true,"raw":"22445.64","odpId":232},"plantedForest":{"odp":true,"raw":"5144.540688","odpId":232},"primaryForest":{"odp":true,"raw":null,"odpId":232},"totalLandArea":{"odp":true,"raw":"30391","odpId":232},"otherWoodedLand":{"odp":true,"raw":"823.48","odpId":232},"totalForestArea":{"odp":true,"raw":"22445.64","odpId":232},"naturalForestArea":{"odp":true,"raw":"17301.099312","odpId":232},"plantationForestArea":{"odp":true,"raw":"24.690204","odpId":232},"otherPlantedForestArea":{"odp":true,"raw":"5119.850484","odpId":232},"plantationForestIntroducedArea":{"odp":true,"raw":"24.690204","odpId":232}},"2010":{"total":{"odp":true,"raw":"22242","odpId":233},"otherLand":{"odp":true,"raw":"7360","odpId":233},"forestArea":{"odp":true,"raw":"22242","odpId":233},"plantedForest":{"odp":true,"raw":"6908.3652","odpId":233},"primaryForest":{"odp":true,"raw":null,"odpId":233},"totalLandArea":{"odp":true,"raw":"30391","odpId":233},"otherWoodedLand":{"odp":true,"raw":"789","odpId":233},"totalForestArea":{"odp":true,"raw":"22242","odpId":233},"naturalForestArea":{"odp":true,"raw":"15333.6348","odpId":233},"plantationForestArea":{"odp":true,"raw":"33.363","odpId":233},"otherPlantedForestArea":{"odp":true,"raw":"6875.0022","odpId":233},"plantationForestIntroducedArea":{"odp":true,"raw":"33.363","odpId":233}},"2015":{"total":{"odp":true,"raw":"22409","odpId":234},"otherLand":{"odp":true,"raw":"7236","odpId":234},"forestArea":{"odp":true,"raw":"22409","odpId":234},"plantedForest":{"odp":true,"raw":"7368.0792","odpId":234},"primaryForest":{"odp":true,"raw":null,"odpId":234},"totalLandArea":{"odp":true,"raw":"30391","odpId":234},"otherWoodedLand":{"odp":true,"raw":"746","odpId":234},"totalForestArea":{"odp":true,"raw":"22409","odpId":234},"naturalForestArea":{"odp":true,"raw":"15040.9208","odpId":234},"plantationForestArea":{"odp":true,"raw":"33.6135","odpId":234},"otherPlantedForestArea":{"odp":true,"raw":"7334.4657","odpId":234},"plantationForestIntroducedArea":{"odp":true,"raw":"33.6135","odpId":234}},"2016":{"plantedForest":{"raw":"7368.08","calculated":true},"totalForestArea":{"raw":"22409","calculated":true},"naturalForestArea":{"raw":"15040.92","estimated":true},"plantationForestArea":{"raw":"33.61","estimated":true},"otherPlantedForestArea":{"raw":"7334.47","estimated":true},"plantationForestIntroducedArea":{"raw":"33.61","estimated":true}},"2017":{"plantedForest":{"raw":"7368.08","calculated":true},"totalForestArea":{"raw":"22409","calculated":true},"naturalForestArea":{"raw":"15040.92","estimated":true},"plantationForestArea":{"raw":"33.61","estimated":true},"otherPlantedForestArea":{"raw":"7334.47","estimated":true},"plantationForestIntroducedArea":{"raw":"33.61","estimated":true}},"2018":{"plantedForest":{"raw":"7368.08","calculated":true},"totalForestArea":{"raw":"22409","calculated":true},"naturalForestArea":{"raw":"15040.92","estimated":true},"plantationForestArea":{"raw":"33.61","estimated":true},"otherPlantedForestArea":{"raw":"7334.47","estimated":true},"plantationForestIntroducedArea":{"raw":"33.61","estimated":true}},"2019":{"plantedForest":{"raw":"7368.08","calculated":true},"totalForestArea":{"raw":"22409","calculated":true},"naturalForestArea":{"raw":"15040.92","estimated":true},"plantationForestArea":{"raw":"33.61","estimated":true},"otherPlantedForestArea":{"raw":"7334.47","estimated":true},"plantationForestIntroducedArea":{"raw":"33.61","estimated":true}},"2020":{"plantedForest":{"raw":"7368.08","calculated":true},"totalForestArea":{"raw":"22409","calculated":true},"naturalForestArea":{"raw":"15040.92","estimated":true},"plantationForestArea":{"raw":"33.61","estimated":true},"otherPlantedForestArea":{"raw":"7334.47","estimated":true},"plantationForestIntroducedArea":{"raw":"33.61","estimated":true}}},"originalDataPointValue":{"1990":{"total":{"odp":true,"raw":"21875.33","odpId":231},"otherLand":{"odp":true,"raw":"7589.769999999999","odpId":231},"forestArea":{"odp":true,"raw":"21875.33","odpId":231},"plantedForest":{"odp":true,"raw":"4390.378731","odpId":231},"primaryForest":{"odp":true,"raw":null,"odpId":231},"totalLandArea":{"odp":true,"raw":"30391","odpId":231},"otherWoodedLand":{"odp":true,"raw":"925.9","odpId":231},"totalForestArea":{"odp":true,"raw":"21875.33","odpId":231},"naturalForestArea":{"odp":true,"raw":"17484.951269","odpId":231},"plantationForestArea":{"odp":true,"raw":"21.87533","odpId":231},"otherPlantedForestArea":{"odp":true,"raw":"4368.503401","odpId":231},"plantationForestIntroducedArea":{"odp":true,"raw":"21.87533","odpId":231}},"2000":{"total":{"odp":true,"raw":"22445.64","odpId":232},"otherLand":{"odp":true,"raw":"7121.880000000001","odpId":232},"forestArea":{"odp":true,"raw":"22445.64","odpId":232},"plantedForest":{"odp":true,"raw":"5144.540688","odpId":232},"primaryForest":{"odp":true,"raw":null,"odpId":232},"totalLandArea":{"odp":true,"raw":"30391","odpId":232},"otherWoodedLand":{"odp":true,"raw":"823.48","odpId":232},"totalForestArea":{"odp":true,"raw":"22445.64","odpId":232},"naturalForestArea":{"odp":true,"raw":"17301.099312","odpId":232},"plantationForestArea":{"odp":true,"raw":"24.690204","odpId":232},"otherPlantedForestArea":{"odp":true,"raw":"5119.850484","odpId":232},"plantationForestIntroducedArea":{"odp":true,"raw":"24.690204","odpId":232}},"2010":{"total":{"odp":true,"raw":"22242","odpId":233},"otherLand":{"odp":true,"raw":"7360","odpId":233},"forestArea":{"odp":true,"raw":"22242","odpId":233},"plantedForest":{"odp":true,"raw":"6908.3652","odpId":233},"primaryForest":{"odp":true,"raw":null,"odpId":233},"totalLandArea":{"odp":true,"raw":"30391","odpId":233},"otherWoodedLand":{"odp":true,"raw":"789","odpId":233},"totalForestArea":{"odp":true,"raw":"22242","odpId":233},"naturalForestArea":{"odp":true,"raw":"15333.6348","odpId":233},"plantationForestArea":{"odp":true,"raw":"33.363","odpId":233},"otherPlantedForestArea":{"odp":true,"raw":"6875.0022","odpId":233},"plantationForestIntroducedArea":{"odp":true,"raw":"33.363","odpId":233}},"2015":{"total":{"odp":true,"raw":"22409","odpId":234},"otherLand":{"odp":true,"raw":"7236","odpId":234},"forestArea":{"odp":true,"raw":"22409","odpId":234},"plantedForest":{"odp":true,"raw":"7368.0792","odpId":234},"primaryForest":{"odp":true,"raw":null,"odpId":234},"totalLandArea":{"odp":true,"raw":"30391","odpId":234},"otherWoodedLand":{"odp":true,"raw":"746","odpId":234},"totalForestArea":{"odp":true,"raw":"22409","odpId":234},"naturalForestArea":{"odp":true,"raw":"15040.9208","odpId":234},"plantationForestArea":{"odp":true,"raw":"33.6135","odpId":234},"otherPlantedForestArea":{"odp":true,"raw":"7334.4657","odpId":234},"plantationForestIntroducedArea":{"odp":true,"raw":"33.6135","odpId":234}}}}}}}

// q http://localhost:9000/api/cycle-data/table/table-data?assessmentName=fra&countryIso=FIN&cycleName=2020&tableNames[]=extentOfForest&tableNames[]=growingStockTotal&tableNames[]=carbonStock&tableNames[]=specificForestCategories&tableNames[]=forestAreaWithinProtectedAreas&tableNames[]=forestOwnership&tableNames[]=primaryDesignatedManagementObjective&tableNames[]=forestCharacteristics&countryISOs[]=FIN&mergeOdp=true
// tablenames
// , , , , forestAreaWithinProtectedAreas, , ,
// total count:

// variable mapping to table:
// variable_name                table_name
// carbon_stock_biomass_total, carbonStock
// carbon_stock_total, carbonStock
// conservation_of_biodiversity, primaryDesignatedManagementObjective
// forestArea,extentOfForest
// forest_area_within_protected_areas,forestAreaWithinProtectedAreas
// growing_stock_total, growingStockTotal
// multiple_use, primaryDesignatedManagementObjective
// naturalForestArea, forestCharacteristics
// other, primaryDesignatedManagementObjective
// other_or_unknown,forestOwnership
// plantedForest, forestCharacteristics
// primary_forest, specificForestCategories
// private_ownership, forestOwnership
// production, primaryDesignatedManagementObjective
// protection_of_soil_and_water, primaryDesignatedManagementObjective
// public_ownership, forestOwnership
// social_services, primaryDesignatedManagementObjective

const _case = (variable: string, table: string) => `when variable_name = '${variable}' then '${table}'`
const _cases = (variables: Array<string>, table: string) => {
  return variables.map((v) => _case(v, table)).join('\n')
}

const _migrateValueAggregate = async (assessment: Assessment, cycle: Cycle) => {
  const schemaCycle = Schemas.getNameCycle(assessment, cycle)
  const where = `variable_name not in ('forest_area_percent', 'primary_forest_ratio', 'totalLandArea')`
  const notExist = `select 1 from ${schemaCycle}.node_ext ne where ne.country_iso = value_aggregate.country_iso and ne.props ->> 'variableName' = value_aggregate.variable_name and ne.props ->> 'colName' = value_aggregate.col_name`
  await client.query(`
      insert into ${schemaCycle}.node_ext (country_iso, type, props, value)

      with value_aggregate as (
      select 
            country_iso,
            case when variable_name = 'growing_stock_total' then 'forest' else variable_name end as variable_name,
            case
              ${_case('forestArea', 'extentOfForest')}
              ${_case('forest_area_within_protected_areas', 'forestAreaWithinProtectedAreas')}
              ${_case('growing_stock_total', 'growingStockTotal')}
              ${_case('primary_forest', 'specificForestCategories')}
              ${_cases(['carbon_stock_biomass_total', 'carbon_stock_total'], 'carbonStock')}
              ${_cases(
                [
                  'conservation_of_biodiversity',
                  'multiple_use',
                  'other',
                  'production',
                  'protection_of_soil_and_water',
                  'social_services',
                ],
                'primaryDesignatedManagementObjective'
              )}
              ${_cases(['other_or_unknown', 'private_ownership', 'public_ownership'], 'forestOwnership')}
              ${_cases(['plantedForest', 'naturalForestArea'], 'forestCharacteristics')}
                else 'ERROR'
            end as table_name,
            col_name,
            -- select value if totalLandArea and select value || {faoEstimate:true} if not totalLandArea
            value || '{"faoEstimate":true}'::jsonb as value
      from ${schemaCycle}.value_aggregate
      where ${where} and not exists (${notExist}))
      select va.country_iso
           , 'node' as type
           , jsonb_build_object(
              'colName', va.col_name,
              'variableName', va.variable_name,
              'tableName', va.table_name
             )      as props
           , va.value
      from value_aggregate va
            `)
}

// const _deprecateValueAggregate = async (assessments: Array<Assessment>): Promise<void> => {
//   await Promises.each(assessments, async (assessment) => {
//     await Promises.each(assessment.cycles, async (cycle) => {
//       const schemaCycle = Schemas.getNameCycle(assessment, cycle)
//       const exists = await client.query(`select 1 from ${schemaCycle}.value_aggregate`)
//       if (exists.length === 0) {
//         // Drop if the table is empty
//         await client.query(`drop table ${schemaCycle}.value_aggregate`)
//       } else {
//         // Move to legacy schema
//         await client.query(`create schema if not exists _legacy_${schemaCycle}`)
//         await client.query(`alter table ${schemaCycle}.value_aggregate set schema _legacy_${schemaCycle}`)
//       }
//     })
//   })
// }

export default async () => {
  const assessments = await AssessmentController.getAll({}, client)
  const assessmentFra = assessments.find((a) => a.props.name === AssessmentNames.fra)
  const cycle2020 = assessmentFra.cycles.find((c) => c.name === '2020')

  await _migrateValueAggregate(assessmentFra, cycle2020)
  // await _deprecateValueAggregate(assessments)
}
